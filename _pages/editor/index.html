<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>ENP Editor</title>
        <link rel="stylesheet" href="common/css/style.css">
    </head>
    <body class="enp-editor_body">
        <div class="enp-editor_wrapper">
        	<div id="js-enp-editor_header" class="enp-editor_header">
                <div class="enp-editor_ruler" id="js-ruler"></div>
            </div>
            <div class="enp-editor_scene">
                <div id="js-breakpoints" style="position: relative"></div>
                <div class="enp-editor_sceneContent" id="js-scene">
                    <span class="enp-editor_sceneHandlerHorz" id="js-handlerHorizontal"></span>
                    <span class="enp-editor_sceneHandlerVert" id="js-handlerVerical"></span>
                    <span class="enp-editor_sceneSize" id="js-size"></span>
                    <span class="enp-editor_sceneSave" id="js-saveScene">
                        zapisz
                    </span>
                    <div id="js-sceneContent" class="enp-editor_aceHolder"></div>  
                </div>
            </div>
            <div class="enp-editor_sidebar">
               
            </div>
            <div class="enp-editor_actionbar"> 
                <ul>
                    <li class="is-active"><a href="#" id="js-togglePreview"><i class="icon-buffer"></i></a></li>
                    <li><a href="#" id="js-toggleHtmlView"><i class="icon-html5"></i></a></li>
                    <li><a href="#" id="js-toggleHCSSView"><i class="icon-css3"></i></a></li>
                    <li><a href="#" id="js-toggleJsView"><i class="icon-code"></i></a></li>
                </ul>
            </div>
        </div>

        <!--  libs -->
        <script src="node_modules/jquery/dist/jquery.min.js"></script>
        <script src="node_modules/underscore/underscore-min.js"></script>
        <script src="node_modules/interact.js/dist/interact.min.js"></script>
        <script src="node_modules/vue/dist/vue.min.js"></script>
        <script src="node_modules/domjson/dist/domJSON.js"></script>
        <script src="bower_components/jquery-ui/ui/core.js"></script>
        <script src="bower_components/jquery-ui/ui/widget.js"></script>
        <script src="bower_components/jquery-ui/ui/mouse.js"></script>
        <script src="bower_components/jquery-ui/ui/draggable.js"></script>
        <script src="bower_components/jquery-ui/ui/droppable.js"></script>
        <script src="bower_components/jquery-ui/ui/resizable.js"></script>
        <script src="vendor/aramk/CSSJSON/json2.js"></script>
        <script src="vendor/aramk/CSSJSON/cssjson.js"></script>
        <script src="vendor/moagrius/copycss/jquery.copycss.js"></script>
        <script src="vendor/tdolsen/jquery-dump/jquery.dump.js"></script>
        <script src="vendor/ajaxorg/ace-builds/src-noconflict/ace.js" charset="utf-8"></script>

        <!-- app -->
        <script src="common/js/app/helpers.js"></script>
		<script src="common/js/app/elements/elements.js"></script>
		<script src="common/js/app/layers/layers.js"></script>
		<script src="common/js/app/scene/scene.js"></script>
		<script src="common/js/app/toolbar/toolbar.js"></script>
        <script src="common/js/app/workspace/workspace.js"></script>
        <script src="common/js/app/main.js"></script>

        <div id="js-scriptsGlobal"></div>
        <div id="js-styleGlobal"></div>

 
                <script>
                interact('#js-scene')
                  .resizable({
                    edges: { 
                        right: '#js-handlerHorizontal',
                        bottom: "#js-handlerVerical"
                    }
                  })
                  .on('resizemove', function (event) {
                    var ruler = document.getElementById('js-size');
                    var target = event.target,
                        x = (parseFloat(target.getAttribute('data-x')) || 0),
                        y = (parseFloat(target.getAttribute('data-y')) || 0);

                    // update the element's style
                    target.style.width  = event.rect.width + 'px';
                    target.style.height = event.rect.height + 'px';
                    ruler.textContent = event.rect.width + 'Ã—' + event.rect.height;
                  });

                var elementArray = [];
                var styles = [];
                var excludedStyles = [
                    'align-content', 
                    'align-items',
                    'align-self',
                    'animation-delay',
                    'animation-direction',
                    'animation-duration',
                    'animation-fill-mode',
                    'animation-iteration-count',
                    'animation-name',
                    'animation-play-state',
                    'animation-timing-function',
                    'backface-visibility',
                    'background-attachment',
                    'background-blend-mode',
                    'background-clip',
                    'background-origin',
                    'box-decoration-break',
                    'caption-side',
                    'clip',
                    'clip-path',
                    'clip-rule',
                    'color-interpolation',
                    'color-interpolation-filters',
                    'counter-increment',
                    'counter-reset',
                    'direction',
                    'dominant-baseline',
                    'empty-cells',
                    'fill',
                    'fill-opacity',
                    'fill-rule',
                    'filter',
                    'flex-basis',
                    'flex-direction',
                    'flex-grow',
                    'flex-shrink',
                    'flex-wrap',
                    'flood-color',
                    'flood-opacity',
                    'font-feature-settings',
                    'font-kerning',
                    'font-language-override',
                    'font-size-adjust',
                    'font-stretch',
                    'font-synthesis',
                    'font-variant',
                    'font-variant-alternates',
                    'font-variant-caps',
                    'font-variant-east-asian',
                    'font-variant-ligatures',
                    'font-variant-numeric',
                    'font-variant-position',
                    'image-orientation',
                    'image-rendering',
                    'ime-mode',
                    'isolation',
                    'justify-content',
                    'lighting-color',
                    'marker-end',
                    'marker-mid',
                    'marker-offset',
                    'marker-start',
                    'mask',
                    'mask-type',
                    'mix-blend-mode',
                    'object-fit',
                    'object-position',
                    'order',
                    'outline-color',
                    'outline-offset',
                    'outline-style',
                    'outline-width',
                    'page-break-after',
                    'page-break-before',
                    'page-break-inside',
                    'paint-order',
                    'perspective',
                    'perspective-origin',
                    'pointer-events',
                    'quotes',
                    'ruby-align',
                    'ruby-position',
                    'scroll-behavior',
                    'shape-rendering',
                    'stop-color',
                    'stop-opacity',
                    'stroke',
                    'stroke-dasharray',
                    'stroke-dashoffset',
                    'stroke-linecap',
                    'stroke-linejoin',
                    'stroke-miterlimit',
                    'stroke-opacity',
                    'stroke-width',
                    'table-layout',
                    'text-anchor',
                    'text-decoration-color',
                    'text-decoration-line',
                    'text-decoration-style',
                    'text-rendering',
                    'transition-timing-function',
                    'unicode-bidi',
                    'vector-effect',
                    'will-change',
                    '-moz-tab-size',
                    '-moz-window-shadow',
                    '-moz-stack-sizing',
                    '-moz-text-align-last',
                    '-moz-text-size-adjust',
                    '-moz-user-focus',
                    '-moz-user-input',
                    '-moz-user-modify',
                    '-moz-user-select',
                    '-moz-window-dragging',
                    '-moz-window-shadow',
                    '-moz-appearance',
                    '-moz-binding',
                    '-moz-border-bottom-colors',
                    '-moz-border-left-colors',
                    '-moz-border-right-colors',
                    '-moz-border-top-colors',
                    '-moz-box-align',
                    '-moz-box-direction',
                    '-moz-box-flex',
                    '-moz-box-ordinal-group',
                    '-moz-box-orient',
                    '-moz-box-pack',
                    '-moz-column-count',
                    '-moz-column-fill',
                    '-moz-column-gap',
                    '-moz-column-rule-color',
                    '-moz-column-rule-style',
                    '-moz-column-rule-width',
                    '-moz-column-width',
                    '-moz-float-edge',
                    '-moz-force-broken-image-icon',
                    '-moz-hyphens',
                    '-moz-image-region',
                    '-moz-orient',
                    '-moz-outline-radius-bottomleft',
                    '-moz-outline-radius-bottomright',
                    '-moz-outline-radius-topleft',
                    '-moz-outline-radius-topright'
                ]
                var elementArray = [];
                var breakpointsArray = [];
                var breaks = [];
                $('#js-saveScene').on('click', function(){
                    $('#js-breakpoints').html("");
                    var media = $('#js-scene').width();
                    var styles = [];
                    
                    var countElements = $('#js-sceneContent *').length;


                    $('#js-sceneContent *').each(function(){
                        var elementStyles = $(this).getStyles(null,excludedStyles)
                        styles.push([$(this).attr('class'), elementStyles]);
                        
                    })
                    var res = _(elementArray).flatten();
                    var position = res.indexOf(media);
                        if (position < 0) {
                            elementArray.push([media, styles])
                            breakpointsArray.push(media)
                        } else {
                            elementArray[position] = [media, styles]
                            breakpointsArray[position] = media;
                        }
                        console.clear()
                        console.log(countElements)
                        console.log(elementArray)
                        breaks = breakpointsArray.sort(function(a, b){return a-b});
                        console.log(breaks)


                        $.each(breaks, function( index, value ) {
                            $('#js-breakpoints').append('<div style="position:relative;height: 7px;"><div style="width:'+value+'px; height: 5px; background: red; left: 0; position: absolute;opacity:0.5" /></div>');
                        });

                })
                </script>


    </body>
</html>